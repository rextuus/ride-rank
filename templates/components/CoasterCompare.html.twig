

{% macro coaster_card(coaster) %}
    <div class="card coaster-card shadow-sm h-100 text-center" data-controller="flip" data-action="click->flip#toggle">
        {% set name = coaster.name ?? '' %}
        {% set image = coaster.image ?? '' %}
        {% set park = coaster.park ?? '' %}
        {% set country = coaster.country ?? '' %}

        <!-- Front side -->
        <div class="card-inner-front" data-flip-target="front">
            <div class="image-container">
                <img src="{{ image }}" class="card-img-top" alt="{{ name }}">
                <button class="magnifying-glass-btn"
                        data-controller="modal"
                        data-action="click->modal#open"
                        data-modal-image-value="{{ image }}"
                        data-modal-title-value="{{ name }}"
                        onclick="event.stopPropagation();">
                    {{ ux_icon('lucide:search', {style: 'height: 1.2em; width: 1.2em;'}) }}
                </button>
            </div>
            <div class="card-body p-2">
                <h5 class="card-title mb-1">{{ name }}</h5>
                <p class="card-text small mb-0">{{ park }}<br><em>{{ country }}</em></p>
            </div>
            <div class="card-footer p-1 bg-transparent border-0">
                <button class="btn ridden-btn {{ coaster.isSeen ? 'btn-success' : 'btn-danger' }} w-100"
                        data-action="click->live#action"
                        data-live-action-param="toggleSeen"
                        data-live-id-param="{{ coaster.id }}"
                        {% if not app.user %}disabled title="Login zum Markieren"{% endif %}
                        onclick="event.stopPropagation();">
                    {{ ux_icon(coaster.isSeen ? 'lucide:check-circle' : 'lucide:circle', {style: 'height: 1.2em; width: 1.2em;'}) }}
                    {{ coaster.isSeen ? 'Gefahren' : 'Nicht gefahren' }}
                </button>
            </div>
        </div>

        <!-- Back side -->
        <div class="card-inner-back" data-flip-target="back">
            <div class="card-body p-2 d-flex flex-column justify-content-center h-100">
                <h5 class="card-title mb-2">{{ name }}</h5>
                {% if coaster.track %}
                    <dl class="small text-start mb-0">
                        {% if coaster.track.length %}
                            <dt class="fw-bold">Länge</dt>
                            <dd class="mb-2">{{ coaster.track.length|round(2) }} m</dd>
                        {% endif %}
                        {% if coaster.track.height %}
                            <dt class="fw-bold">Höhe</dt>
                            <dd class="mb-2">{{ coaster.track.height|round }} m</dd>
                        {% endif %}
                        {% if coaster.track.speed %}
                            <dt class="fw-bold">Geschwindigkeit</dt>
                            <dd class="mb-2">{{ coaster.track.speed|round }} km/h</dd>
                        {% endif %}
                        {% if coaster.track.inversions %}
                            <dt class="fw-bold">Inversionen</dt>
                            <dd class="mb-2">{{ coaster.track.inversions }}</dd>
                        {% endif %}
                        {% if coaster.track.duration %}
                            <dt class="fw-bold">Dauer</dt>
                            <dd class="mb-2">{{ coaster.track.duration }} Sekunden</dd>
                        {% endif %}
                        {% if coaster.track.drop %}
                            <dt class="fw-bold">Drop</dt>
                            <dd class="mb-2">{{ coaster.track.drop|round }}°</dd>
                        {% endif %}
                    </dl>
                {% else %}
                    <p class="text-muted small">Keine Detailinformationen verfügbar</p>
                {% endif %}
            </div>
            <div class="card-footer p-1 bg-transparent border-0">
                <button class="btn btn-sm {{ coaster.isSeen ? 'btn-success' : 'btn-outline-secondary' }} w-100"
                        data-action="click->live#action"
                        data-live-action-param="toggleSeen"
                        data-live-id-param="{{ coaster.id }}"
                        {% if not app.user %}disabled title="Login zum Markieren"{% endif %}
                        onclick="event.stopPropagation();">
                    {{ ux_icon(coaster.isSeen ? 'lucide:check-circle' : 'lucide:circle', {style: 'height: 1.2em; width: 1.2em;'}) }}
                    {{ coaster.isSeen ? 'Gesehen' : 'Markieren' }}
                </button>
            </div>
        </div>
    </div>
{% endmacro %}

<div{{ attributes }}>
    <div data-controller="loading">
        <div class="row g-3">
            <div class="col-6">
                {{ _self.coaster_card(this.left) }}
            </div>
            <div class="col-6">
                {{ _self.coaster_card(this.right) }}
            </div>
        </div>

        <div class="d-flex justify-content-between align-items-center mt-4 gap-2">
            <button data-action="click->loading#stop click->live#action" data-live-action-param="chooseLeft"
                    class="btn btn-lg btn-choice btn-outline-dark flex-fill">
                <i>{{ ux_icon('icons8:left-round', {style: 'height: 1.5em;'}) }}</i> Links
            </button>
            <button data-action="click->loading#stop click->live#action" data-live-action-param="skip"
                    class="btn btn-lg btn-choice btn-outline-secondary btn-filled flex-fill">
                <i>{{ ux_icon('material-symbols:refresh', {style: 'height: 1.5em;'}) }}</i> Skip
            </button>
            <button data-action="click->loading#stop click->live#action" data-live-action-param="chooseRight"
                    class="btn btn-lg btn-choice btn-outline-dark flex-fill">
                Rechts <i>{{ ux_icon('icons8:right-round', {style: 'height: 1.5em;'}) }}</i>
            </button>
        </div>
    </div>
</div>